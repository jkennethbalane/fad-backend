# upstream app_server {
#   server strapi:8080;
# }
# server {
#   listen 80;

#   # Common Proxy Settings
#   proxy_http_version 1.1;
#   proxy_set_header Connection $http_connection;
#   proxy_set_header Upgrade $http_upgrade;

#   location / {
#     proxy_pass http://app_server;
#     proxy_redirect off;
#     proxy_pass_header Server;
#     proxy_set_header Host $host;
#     proxy_set_header X-Real-IP $remote_addr;
#     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#     proxy_set_header X-Forwarded-Host $server_name;
#     proxy_set_header X-Forwarded-Proto $scheme;

#     proxy_set_header Upgrade $http_upgrade;
#     proxy_set_header Connection "upgrade";
#   }
# }
server {
    # Listen HTTP
    listen 80;

    # Redirect HTTP to HTTPS
    return 301 https://$host$request_uri;
}

server {
    # Listen HTTPS
    listen 443 ssl;

    # SSL config
    ssl_certificate /etc/nginx/ssl/certificate.crt;
    ssl_certificate_key /etc/nginx/ssl/private.key;

    # Proxy Config
    location / {
        proxy_pass http://strapi:1337;
        proxy_http_version 1.1;
        proxy_set_header X-Forwarded-Host $host;
        proxy_set_header X-Forwarded-Server $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header Host $http_host;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "Upgrade";
        proxy_pass_request_headers on;
    }
}
  # location /admin/ {
  #   proxy_pass http://strapi_server;
  #   proxy_redirect off;
  #   proxy_pass_header Server;
  # }


  # location /i18n/ {  
  #   proxy_pass http://strapi:1337/i18n/;
  #   proxy_redirect off;
  #   proxy_pass_header Server;
  # }

  # location /api/ {
  #   proxy_pass http://strapi:1337/api;
  #   proxy_redirect off;
  #   proxy_pass_header Server;
  # }
  # location /content-manager/ {
  #   proxy_pass http://strapi:1337/content-manager;
  #   proxy_redirect off;
  #   proxy_pass_header Server;
  # }
  # location /content-manager/content-types/ {
  #   proxy_pass http://strapi:1337/content-manager/content-types;
  #   proxy_redirect off;
  #   proxy_pass_header Server;
  # }
  # location /content-manager/content-types/plugin::users-permissions.user/configuration/ {
  #   proxy_pass http://strapi:1337/content-manager/content-types/plugin::users-permissions.user/configuration;
  #   proxy_redirect off;
  #   proxy_pass_header Server;
  # }
  # location /content-manager/collection-types/plugin/ {
  #   proxy_pass http://strapi:1337/content-manager/collection-types/plugin;
  #   proxy_redirect off;
  #   proxy_pass_header Server;
  # }
  # location /content-manager/init/ {
  #   proxy_pass http://strapi:1337/content-manager/init;
  #   proxy_redirect off;
  #   proxy_pass_header Server;
  # }
  # location /content-manager/content-types-settings/ {
  #   proxy_pass http://strapi:1337/content-manager/content-types-settings;
  #   proxy_redirect off;
  #   proxy_pass_header Server;
  # }
  # location /content-manager/components/ {
  #   proxy_pass http://strapi:1337/content-manager/components;
  #   proxy_redirect off;
  #   proxy_pass_header Server;
  # }
  # location /content-type-builder/content-types/ {
  #   proxy_pass http://strapi:1337/content-type-builder/content-types;
  #   proxy_redirect off;
  #   proxy_pass_header Server;
  # }
  # location /content-type-builder/reserved-names/ {
  #   proxy_pass http://strapi:1337/content-type-builder/reserved-names;
  #   proxy_redirect off;
  #   proxy_pass_header Server;
  # }
  # location /content-type-builder/components/ {
  #   proxy_pass http://strapi:1337/content-type-builder/components;
  #   proxy_redirect off;
  #   proxy_pass_header Server;
  # }
  # location /upload/ {
  #   proxy_pass http://strapi:1337/upload;
  #   proxy_redirect off;
  #   proxy_pass_header Server;
  # }


# server {
#     # Listen HTTP
#     listen 81;
#     server_name example.com;

#     # Redirect HTTP to HTTPS
#     return 301 https://$host$request_uri;
# }

# server {
#     # Listen HTTPS
#     listen 443 ssl;
#     server_name example.com;

#     # SSL config
#     ssl_certificate /path/to/your/certificate/file;
#     ssl_certificate_key /path/to/your/certificate/key;

#     # Static Root
#     location / {
#         root /var/www/html;
#     }

#     # Strapi API and Admin
#     location /test/ {
#         rewrite ^/test/?(.*)$ /$1 break;
#         proxy_pass http://strapi;
#         proxy_http_version 1.1;
#         proxy_set_header X-Forwarded-Host $host;
#         proxy_set_header X-Forwarded-Server $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#         proxy_set_header Host $http_host;
#         proxy_set_header Upgrade $http_upgrade;
#         proxy_set_header Connection "Upgrade";
#         proxy_pass_request_headers on;
#     }